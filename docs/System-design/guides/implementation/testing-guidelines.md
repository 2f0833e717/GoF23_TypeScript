# テスト方針

このドキュメントでは、GoF23デザインパターンTypeScript実装プロジェクトのテスト方針とベストプラクティスについて説明します。

## 1. テスト種類と範囲
- **単体テスト**: 各クラス/コンポーネントの機能を個別にテスト
- **統合テスト**: パターンの実装が連携して動作することを確認
- **E2Eテスト**: 具体的なユースケースでの動作を確認
- **パフォーマンステスト**: 重要な操作の性能を検証
- **バウンダリテスト**: エッジケースと境界値をテスト

## 2. テスト実装指針
- テストサイズの原則: 小さく、高速で、独立したテストを作成する
- 1テストファイルにつき1クラス/コンポーネントのテスト
- AAA (Arrange-Act-Assert) パターンに従う
- モックやスタブを適切に使用する
- エッジケースとバリエーションをカバーする
- テストケースには明確な名前を付ける
- テストカバレッジ80%以上を目指す
- データ駆動テストを活用して複数のシナリオをテスト

## 3. テストライブラリの活用
- **Jest**: 主要なテストフレームワーク
- **ts-jest**: TypeScriptサポート
- **jest-extended**: アサーション機能の拡張
- **@testing-library**: UI/DOMテスト
- **supertest**: APIテスト
- **nock/msw**: HTTPモック
- **faker/chance**: テストデータ生成

## 4. モックとスタブ
- 外部依存をモックして単体テストを分離する
- 適切なレベルでモックを作成（メソッドレベル、モジュールレベル、サービスレベル）
- モックの振る舞いを詳細に指定（戻り値、例外、非同期動作）
- コンテキストに応じてスパイを使用して呼び出しを検証
- Jest のモック機能を活用（jest.fn(), jest.mock()）
- 依存性注入を使用してテスト可能なコードを設計

## 5. テストファイル命名と配置
- テストファイル名は `{テスト対象}.test.ts` とする
- ディレクトリ構造は実装と一致させる
- 例:
  ```
  tests/
  ├── behavioral/
  │   └── observer/
  │       ├── Subject.test.ts
  │       ├── ConcreteSubject.test.ts
  │       └── integration.test.ts  # 統合テスト
  ```

## 6. 継続的テスト
- CI/CDパイプラインでテストを自動実行
- プルリクエスト時にテストを実行し品質を確保
- 定期的なテスト実行でリグレッションを検出
- テストカバレッジレポートを生成して分析
- テスト実行時間を監視し、遅いテストを最適化

## 7. パターン固有のテスト戦略

### 7.1 生成パターンのテスト
- シングルトン: インスタンスの唯一性の検証
- ファクトリーメソッド: 正しい型のオブジェクトが生成されることの確認
- 抽象ファクトリー: 関連オブジェクト群の一貫性の検証
- ビルダー: 構築プロセスと生成物の整合性の確認
- プロトタイプ: クローンの深いコピーの検証

### 7.2 構造パターンのテスト
- アダプター: インターフェース変換の正確性の検証
- ブリッジ: 抽象と実装の分離の確認
- コンポジット: 単一オブジェクトとコンポジットの同一操作の検証
- デコレーター: 機能追加の累積的効果の確認
- ファサード: 簡略化されたインターフェースの動作確認
- フライウェイト: メモリ使用量の最適化の検証
- プロキシ: 本物のオブジェクトと同等の振る舞いの確認

### 7.3 振る舞いパターンのテスト
- 責任連鎖: 要求の適切な処理者への伝播の検証
- コマンド: 実行、履歴管理、アンドゥ機能の確認
- インタープリター: 文法解析と実行の正確性の検証
- イテレーター: コレクション要素の順次アクセスの確認
- メディエーター: オブジェクト間通信の集中管理の検証
- メメント: 状態の保存と復元の正確性の確認
- オブザーバー: 状態変化時の通知の検証
- ステート: 状態に応じた振る舞いの変化の確認
- ストラテジー: アルゴリズムの交換可能性の検証
- テンプレートメソッド: 骨格アルゴリズムとフックメソッドの連携確認
- ビジター: 要素構造と操作の分離の検証

## 8. テスト品質の評価
- カバレッジだけでなく、テストの質も重視する
- エッジケースのカバー率を評価する
- 失敗シナリオのテストを含める
- 非機能要件（パフォーマンス、セキュリティ）のテストを含める
- テストの保守性を定期的に評価する
- テストコードのコードレビューを実施する 